<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bright Tup Up — Efootball & Manga</title>

<style>
body {
    margin: 0;
    padding: 0;
    background: #0d0d0d;
    font-family: "Arial", sans-serif;
    color: #e0f7ff;
}

.header {
    padding: 20px;
    background: linear-gradient(to right, #000, #001a33);
    text-align: center;
    font-size: 28px;
    font-weight: bold;
    letter-spacing: 2px;
    color: #00ccff;
}

/* ===================== ICONE D'ARME ===================== */
.weapon-icon {
    width: 30px;
    height: 12px;
    background: #00ccff;
    position: relative;
    display: inline-block;
    border-radius: 2px;
    margin-right: 10px;
}
.weapon-icon::before {
    content:"";
    position:absolute;
    width:6px;
    height:20px;
    background:#00ccff;
    top:-4px;
    left:2px;
    border-radius:1px;
}
.weapon-icon::after {
    content:"";
    position:absolute;
    width:8px;
    height:8px;
    background:#00ccff;
    top:2px;
    right:-6px;
    transform: rotate(45deg);
    border-radius:1px;
}

#soldeBox {
    text-align:center;
    font-size:18px;
    margin-top:-10px;
    color:#00ccff;
    font-weight:bold;
}

.back-btn {
    margin: 20px;
    display: inline-block;
    background: #111;
    border: 1px solid #003366;
    padding: 10px 20px;
    border-radius: 10px;
    color: #00ccff;
    text-decoration: none;
    font-size: 16px;
}

.product-card {
    background: #111;
    border: 1px solid #003366;
    padding: 20px;
    margin: 20px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    box-shadow: 0 0 10px rgba(0,204,255,0.1);
}

.product-img {
    width: 75px;
    height: 75px;
    border-radius: 10px;
    background:#111;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 28px;
    color: #00ccff;
    margin-right: 20px;
}

.product-info h3 { margin: 0; font-size: 22px; }

.tag {
    background: #00ff99;
    padding: 4px 10px;
    border-radius: 10px;
    font-size: 12px;
    display: inline-block;
    margin-top: 8px;
}

.tag-gray {
    background: #003366;
    padding: 4px 10px;
    border-radius: 10px;
    font-size: 12px;
    display: inline-block;
    margin-left: 5px;
}

.price {
    font-size: 20px;
    font-weight: bold;
    margin-top: 10px;
    color: #00ccff;
}

.buy-btn {
    margin-top: 15px;
    padding: 12px 20px;
    width: 100%;
    font-size: 18px;
    border: none;
    border-radius: 10px;
    background: #00aaff;
    color: black;
    font-weight: bold;
    cursor: pointer;
}

#overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    backdrop-filter: blur(6px);
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.form-box {
    width: 90%;
    max-width: 420px;
    background: #111;
    padding: 25px;
    border-radius: 15px;
    border: 1px solid #003366;
    box-shadow: 0 0 20px rgba(0,204,255,0.2);
    animation: pop 0.2s ease-out;
}

@keyframes pop {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.form-box h2 {
    margin-top: 0;
    text-align: center;
    color: #00ccff;
}

select, input {
    width: 100%;
    padding: 13px;
    margin: 10px 0;
    border-radius: 10px;
    border: none;
    background: #1a1a1a;
    color: white;
    font-size: 16px;
}

.submit-btn {
    width: 100%;
    padding: 15px;
    background: #00aaff;
    color: black;
    border: none;
    font-size: 18px;
    font-weight: bold;
    border-radius: 10px;
    margin-top: 10px;
    cursor: pointer;
}

.close-btn {
    margin-top: 10px;
    width: 100%;
    padding: 13px;
    background: #333;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
}

.cart-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #00aaff;
    padding: 15px 20px;
    border-radius: 50px;
    font-size: 18px;
    font-weight: bold;
    color: black;
    border: none;
    cursor: pointer;
}
</style>
</head>

<body>

<div class="header"><span class="weapon-icon"></span> Bright Tup Up</div>

<div id="soldeBox">Solde : 0 G</div>

<a class="back-btn" href="produits.html">← Retour</a>

<div id="products-container"></div>

<div id="overlay">
    <div class="form-box">
        <h2 id="form-title"></h2>

        <select id="typeCompte">
            <option value="">Type de compte</option>
            <option>Google</option>
            <option>Bright Tup Up</option>
            <option>Facebook</option>
        </select>

        <input type="email" id="email" placeholder="Votre Email">
        <input type="password" id="mdp" placeholder="Mot de passe">

        <div style="display:flex; gap:10px;">
            <select id="country" style="width:140px;"></select>
            <input id="whatsapp" placeholder="Numéro WhatsApp" style="flex:1;">
        </div>

        <button class="submit-btn" onclick="ajouterPanier()">Ajouter au panier</button>
        <button class="close-btn" onclick="closeForm()">Fermer</button>
    </div>
</div>

<button class="cart-btn" onclick="ouvrirPanier()">Voir panier</button>

<script>
let user = JSON.parse(sessionStorage.getItem("dpstore_user") || "{}");
if (!user.email || !user.username) { 
    alert("⚠ Vous devez être connecté !");
    window.location.href = "index.html";
}
if (!user.balance) user.balance = 0;
document.getElementById("soldeBox").textContent = "Solde : " + user.balance + " G";

/* LISTE PAYS */
const countries = [
    { name: "Haïti", code: "+509" },
    { name: "France", code: "+33" },
    { name: "Canada", code: "+1" },
    { name: "USA", code: "+1" },
    { name: "Belgique", code: "+32" },
    { name: "Suisse", code: "+41" }
];
let countrySelect = document.getElementById("country");
countries.forEach(c => {
    let opt = document.createElement("option");
    opt.value = c.code;
    opt.textContent = `${c.name} (${c.code})`;
    countrySelect.appendChild(opt);
});

/* PRODUITS */
const produits = [
    { titre: "WEEKLY SUPPLY PASS", prix: 450 },
    { titre: "MONTHLY SUPPLY PASS", prix: 1750 },
    { titre: "80 UC", prix: 180 },
    { titre: "420 CP", prix: 850 },
    { titre: "880 UC", prix: 1750 },
    { titre: "2400 UC", prix: 4200 }
];
let produitSelectionne = null;

function afficherProduits() {
    let html = "";
    produits.forEach(p => {
        const prixFinal = Math.round(p.prix * 1.20);
        html += `
        <div class="product-card">
            <div class="product-img"><span class="weapon-icon"></span></div>
            <div class="product-info">
                <h3>${p.titre}</h3>
                <span class="tag">Disponible</span>
                <span class="tag-gray">Bright Tup Up</span>
                <div class="price">${prixFinal} G</div>
                <button class="buy-btn" onclick="openForm('${p.titre}', ${prixFinal})">Acheter</button>
            </div>
        </div>`;
    });
    document.getElementById("products-container").innerHTML = html;
}
afficherProduits();

/* FORMULAIRE */
function openForm(titre, prix){
    produitSelectionne = { titre, prix };
    document.getElementById("form-title").innerText = titre;
    document.getElementById("overlay").style.display = "flex";
}
function closeForm(){ document.getElementById("overlay").style.display = "none"; }

/* PANIER */
function normalizeId(str){ return (str||"guest").toLowerCase().replace(/[^a-z0-9@.-]/g,"_").replace(/@/g,"_at_"); }
function getCartKey(){ return "cart_" + normalizeId(user.email); }
function loadCart(){ return JSON.parse(localStorage.getItem(getCartKey())||"[]"); }
function saveCart(cart){ localStorage.setItem(getCartKey(), JSON.stringify(cart)); }

function ajouterPanier(){
    let type = document.getElementById("typeCompte").value;
    let emailForm = document.getElementById("email").value;
    let mdp = document.getElementById("mdp").value;
    let wp = document.getElementById("whatsapp").value;
    let indicatif = document.getElementById("country").value;

    if(!type || !emailForm || !mdp || !wp){ alert("Veuillez remplir tout le formulaire !"); return; }

    const cart = loadCart();
    cart.push({
        name: produitSelectionne.titre,
        price: produitSelectionne.prix,
        compte: type,
        email: emailForm,
        mdp: mdp,
        whatsapp: indicatif+" "+wp,
        date: new Date().toLocaleString()
    });
    saveCart(cart);
    closeForm();
    alert("Produit ajouté au panier !");
}

function ouvrirPanier(){
    localStorage.setItem("lastPage", window.location.href);
    window.location.href = "cart.html";
}

setInterval(()=> {
    document.getElementById("soldeBox").textContent = "Solde : " + (user.balance ?? 0) + " G";
}, 1500);

</script>

</body>
</html>
