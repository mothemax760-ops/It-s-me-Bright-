<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bright Tup Up | PUBG MOBILE</title>
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at top, #001a33, #000);
  margin:0;
  padding:0;
  color:#e0f7ff;
}

/* HEADER */
header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:15px 20px;
  background:rgba(5,10,20,0.95);
  position:sticky;
  top:0;
  z-index:20;
  border-bottom:2px solid #00aaff;
  box-shadow:0 0 10px #00aaff;
}
.back-btn {
  background:none;
  border:2px solid #00aaff;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
  color:#00ccff;
  font-weight:bold;
}
.logo { font-weight:bold; color:#00ccff; font-size:1.4rem; letter-spacing:2px; }
.right-box { display:flex; align-items:center; gap:14px; }
.balance-bubble { padding:6px 12px; border-radius:8px; background:rgba(0,170,255,0.1); color:#00ccff; font-weight:bold; border:1px solid #00aaff; }

/* PRODUCTS */
#product-list { margin:15px; display:grid; gap:15px; }
.product-box {
  background:rgba(5,10,20,0.95);
  padding:15px;
  border-radius:14px;
  border:1px solid #00aaff33;
  box-shadow:0 0 12px #00aaff22;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.product-name { font-weight:bold; font-size:1.2rem; }
.status-tag { background:#00c853; color:#000; padding:3px 10px; border-radius:10px; font-weight:bold; font-size:0.8rem; }
.category-tag { background:#50545b; color:#fff; padding:3px 10px; border-radius:10px; font-size:0.8rem; margin-left:5px; }
.price { font-weight:bold; font-size:1.1rem; color:#00ccff; }
.add-btn { padding:10px; background:linear-gradient(90deg,#00aaff,#004466); color:#000; font-weight:bold; border:none; border-radius:8px; cursor:pointer; }
.add-btn:hover { box-shadow:0 0 12px #00aaff; }

/* POPUP */
#popup {
  display:none;
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  justify-content:center; align-items:center;
  background:rgba(0,0,0,0.75);
  z-index:9999;
}
.popup-content {
  width:90%; max-width:420px;
  background:rgba(5,10,20,0.95);
  padding:25px;
  border-radius:12px;
  border:2px solid #00aaff;
  color:#e0f7ff;
  box-shadow:0 0 25px #00aaff;
  display:flex; flex-direction:column; gap:10px;
}
.popup-content h3 { margin:0; color:#00ccff; text-align:center; }
.popup-content input, .popup-content select { width:100%; padding:12px; border-radius:8px; border:1px solid #00aaff; background:rgba(0,0,0,0.4); color:#e0f7ff; }
.popup-content button { width:100%; padding:12px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
.submit-btn { background:linear-gradient(90deg,#00aaff,#004466); color:#000; }
.close-btn { background:red; color:#fff; }

/* AK-47 ICON */
.ak47 { width:100%; height:80px; background:#003366; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#00ccff; font-weight:bold; }
</style>
</head>
<body>

<header>
  <button class="back-btn" onclick="window.location.href='produits.html'">‚Üê Retour</button>
  <div class="logo">BRIGHT PUBG</div>
  <div class="right-box">
    <div class="balance-bubble" id="balanceBox">0 G</div>
    <div class="cart-btn" onclick="gotoCart()">üõí(<span id="cartCount">0</span>)</div>
  </div>
</header>

<h2 style="margin-left:15px;color:#00ccff;">PUBG MOBILE ‚Äî AK‚Äë47 Packages</h2>
<div id="product-list"></div>

<!-- POPUP -->
<div id="popup">
  <div class="popup-content">
    <h3 id="popupTitle"></h3>
    <input id="accountName" placeholder="Nom du compte">
    <input id="accountUID" placeholder="UID du compte">
    <select id="country"></select>
    <input id="whatsapp" placeholder="Num√©ro WhatsApp">
    <button class="submit-btn" onclick="validateForm()">Ajouter au panier</button>
    <button class="close-btn" onclick="closePopup()">Annuler</button>
  </div>
</div>

<script>
/* ======================
   UTIL & PROFIL
====================== */
function safeParse(str){ try{ return JSON.parse(str);}catch(e){return null;} }
let user = safeParse(sessionStorage.getItem("dpstore_user")) || {};
if(!user.email || !user.username){ alert("‚ö† Connectez-vous !"); window.location.href="index.html"; }

function updateBalanceUI(){ document.getElementById("balanceBox").textContent = (user.balance??0)+" G"; }
function normalizeId(str){ return (str||"guest").toLowerCase().replace(/[^a-z0-9@.-]/g,"_").replace(/@/g,"_at_"); }
function getCartKey(){ return "cart_"+normalizeId(user.email); }
function loadCart(){ return JSON.parse(localStorage.getItem(getCartKey())||"[]"); }
function saveCart(cart){ localStorage.setItem(getCartKey(),JSON.stringify(cart)); }
function updateCartCount(){ document.getElementById("cartCount").textContent = loadCart().length; }
function gotoCart(){ window.location.href="cart.html"; }
updateBalanceUI(); updateCartCount();

/* ======================
   PAYS
====================== */
const countries = [
  {name:"Ha√Øti", code:"+509"},
  {name:"France", code:"+33"},
  {name:"USA", code:"+1"},
  {name:"S√©n√©gal", code:"+221"}
];
let countrySelect = document.getElementById("country");
countries.forEach(c=>{
  let opt=document.createElement("option");
  opt.value=c.code; opt.textContent=`${c.name} (${c.code})`;
  countrySelect.appendChild(opt);
});

/* ======================
   PRODUITS
====================== */
const products=[
  {name:"60 UC AK‚Äë47", price:180},
  {name:"120 UC AK‚Äë47", price:350},
  {name:"325 UC AK‚Äë47", price:850},
  {name:"660 UC AK‚Äë47", price:1650},
  {name:"1800 UC AK‚Äë47", price:3500}
];
products.forEach(p=>p.price=Math.round(p.price*1.20));

const productList=document.getElementById("product-list");
let selectedProduct=null;

products.forEach(p=>{
  const box=document.createElement("div");
  box.className="product-box";
  box.innerHTML=`
    <div class="ak47">AK‚Äë47 IMAGE</div>
    <div class="product-name">${p.name}</div>
    <span class="status-tag">Disponible</span>
    <span class="category-tag">PUBG MOBILE</span>
    <div class="price">${p.price} HTG</div>
    <button class="add-btn">Acheter</button>
  `;
  box.querySelector("button").addEventListener("click",()=>{
    selectedProduct=p;
    document.getElementById("popupTitle").textContent=`${p.name} - ${p.price} HTG`;
    document.getElementById("accountName").value=user.username;
    document.getElementById("accountUID").value="";
    document.getElementById("country").value=countries[0].code;
    document.getElementById("whatsapp").value="";
    document.getElementById("popup").style.display="flex";
  });
  productList.appendChild(box);
});

/* ======================
   POPUP & PANIER
====================== */
function closePopup(){ document.getElementById("popup").style.display="none"; }
function validateForm(){
  const name=document.getElementById("accountName").value.trim();
  const uid=document.getElementById("accountUID").value.trim();
  const wp=document.getElementById("whatsapp").value.trim();
  const country=document.getElementById("country").value;
  if(!name||!uid||!wp){ alert("Remplissez tous les champs"); return; }
  const cart=loadCart();
  cart.push({
    name:selectedProduct.name,
    price:selectedProduct.price,
    buyer:user.email,
    date:new Date().toLocaleString(),
    status:"En attente",
    meta:{accountName:name, uid:uid, whatsapp:country+" "+wp}
  });
  saveCart(cart);
  closePopup();
  updateCartCount();
  alert("Produit ajout√© au panier !");
}
</script>

</body>
</html>
