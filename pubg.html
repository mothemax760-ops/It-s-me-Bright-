<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bright Tup Up | PUBG MOBILE</title>
<style>
  body {margin:0;font-family:'Poppins',sans-serif;background:#001a33;color:#e0f7ff;}
  header {background:rgba(5,10,20,0.95);padding:15px 25px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 0 15px #ff7b00aa;position:sticky;top:0;z-index:10;}
  header h1 {font-size:1.5rem;font-weight:700;color:#ffb347;text-shadow:0 0 15px #ff7b00,0 0 30px #ff4500;}
  .balance-box {background:rgba(255,123,0,0.2);border:1px solid #ff7b00;padding:6px 12px;border-radius:10px;font-weight:bold;color:#ffae00;margin-right:10px;}
  .container {padding:30px;}
  .section-title {font-size:1.8rem;margin:20px 0;text-align:center;text-shadow:0 0 10px #ff6f00;letter-spacing:2px;}
  .grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:25px;}
  .card {position:relative;background:linear-gradient(145deg,rgba(255,140,0,0.2),rgba(0,0,0,0.6));border:2px solid #ff6f00;border-radius:15px;padding:20px;text-align:center;box-shadow:0 0 20px #ff7b00aa;transition:0.3s;overflow:hidden;}
  .card:hover {transform:scale(1.05);box-shadow:0 0 30px #ffae00;}
  .card h3 {font-size:1.2rem;margin-bottom:10px;}
  .status {background:#00ff99;color:#000;padding:3px 10px;border-radius:10px;font-size:0.8rem;font-weight:700;}
  .tag {background:#ff7b00;color:#000;padding:3px 10px;border-radius:10px;font-size:0.8rem;font-weight:700;margin-left:5px;}
  .price {font-size:1.1rem;font-weight:bold;color:#ffb347;text-shadow:0 0 5px #ff7b00;margin-top:10px;}
  .btn-primary {background:#ff7b00;color:#000;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:bold;margin-top:15px;transition:0.3s;}
  .btn-primary:hover {background:#fff;color:#ff7b00;box-shadow:0 0 20px #ffae00;}
  .back-btn {position:fixed;top:20px;left:20px;background:rgba(255,123,0,0.2);border:1px solid #ff7b00;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;z-index:50;transition:0.3s;}
  .back-btn:hover {background:#ff7b00;color:#000;}
  .toast {position:fixed;bottom:25px;left:50%;transform:translateX(-50%);background:#ff7b00;color:#000;padding:10px 20px;border-radius:10px;font-weight:bold;opacity:0;transition:opacity 0.4s;}
  .toast.show {opacity:1;}
  .ak47 {position:relative;width:75px;height:40px;margin:auto 0 12px 0;}
  .ak47 .barrel {position:absolute;top:12px;left:0;width:60px;height:4px;background:#ff7b00;border-radius:2px;}
  .ak47 .stock {position:absolute;bottom:0;left:50px;width:18px;height:12px;background:#ff7b00;border-radius:2px;}
  .ak47 .mag {position:absolute;bottom:12px;left:20px;width:6px;height:16px;background:#ff7b00;transform:rotate(-10deg);border-radius:1px;}
  .ak47 .sight {position:absolute;top:8px;right:0;width:6px;height:4px;background:#ff7b00;border-radius:1px;}

  /* POPUP */
  #popup {position:fixed;top:0;left:0;width:100%;height:100%;display:none;justify-content:center;align-items:center;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);z-index:9999;}
  .popup-content {width:90%;max-width:380px;background:#001a33;padding:20px;border-radius:14px;box-shadow:0 0 20px #ff7b0044;}
  .popup-content h2 {text-align:center;color:#ffb347;}
  .popup-content input, .popup-content select {width:100%;padding:12px;margin:8px 0;border-radius:10px;border:none;background:#0a1a33;color:#e0f7ff;}
  .popup-content .submit-btn {width:100%;padding:12px;margin-top:10px;border:none;border-radius:10px;background:#ff7b00;color:#000;font-weight:bold;cursor:pointer;}
  .popup-content .close-btn {width:100%;padding:12px;margin-top:10px;border:none;border-radius:10px;background:#333;color:#fff;font-weight:bold;cursor:pointer;}
</style>
</head>
<body>

<button class="back-btn" onclick="window.location.href='produits.html'">⬅ Retour</button>

<header>
  <h1>Bright Tup Up — PUBG MOBILE</h1>
  <div style="display:flex; align-items:center;">
    <div class="balance-box" id="balanceBox">0 G</div>
  </div>
</header>

<div class="container">
  <h2 class="section-title">PUBG MOBILE UC</h2>
  <div class="grid" id="productGrid"></div>
</div>

<div id="toast" class="toast">✅ Ajouté au panier</div>

<!-- POPUP ACHAT -->
<div id="popup">
  <div class="popup-content">
    <h2 id="popupTitle">Produit</h2>
    <select id="accountType">
      <option value="">Type de compte</option>
      <option>Google</option>
      <option>PUBG</option>
      <option>Facebook</option>
    </select>
    <input type="email" id="emailForm" placeholder="Email">
    <input type="password" id="passwordForm" placeholder="Mot de passe">
    <input type="text" id="uidForm" placeholder="UID du compte">
    <select id="countryForm"></select>
    <input type="text" id="whatsappForm" placeholder="Numéro WhatsApp">
    <button class="submit-btn" onclick="addToCart()">Ajouter au panier</button>
    <button class="close-btn" onclick="closePopup()">Fermer</button>
  </div>
</div>

<script>
/* ==========================
   UTIL + PROFIL CONNECTÉ
========================== */
function safeParse(str){try{return JSON.parse(str);}catch(e){return null;}}
let user=safeParse(sessionStorage.getItem("dpstore_user"))||null;
if(!user||!user.email||!user.username){alert("⚠ Vous devez être connecté !");window.location.href="index.html";}

function normalizeId(str){return (str||"guest").toLowerCase().replace(/[^a-z0-9@.-]/g,"_").replace(/@/g,"_at_");}
function getCartKey(){return "cart_"+normalizeId(user.email);}
function loadCart(){return JSON.parse(localStorage.getItem(getCartKey())||"[]");}
function saveCart(cart){localStorage.setItem(getCartKey(),JSON.stringify(cart));}

function updateBalanceUI(){user=safeParse(sessionStorage.getItem("dpstore_user"))||user;document.getElementById("balanceBox").textContent=(user.balance??0)+" G";}
function showToast(){const t=document.getElementById("toast");t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1500);}

/* ==========================
   LISTE PAYS
========================== */
const countries=[{name:"Haïti",code:"+509"},{name:"France",code:"+33"},{name:"Canada",code:"+1"},{name:"États-Unis",code:"+1"},{name:"République Dominicaine",code:"+1-809"}];
const countrySelect=document.getElementById("countryForm");
countries.forEach(c=>{let opt=document.createElement("option");opt.value=c.code;opt.textContent=c.name+" ("+c.code+")";countrySelect.appendChild(opt);});

/* ==========================
   PRODUITS
========================== */
const products=[
  {name:"60 UC",price:180},
  {name:"120 UC",price:350},
  {name:"325 UC",price:850},
  {name:"660 UC",price:1650},
  {name:"1800 UC",price:3500}
];
products.forEach(p=>p.price=Math.round(p.price*1.2));

const grid=document.getElementById("productGrid");
let selectedProduct=null;

products.forEach(p=>{
  const card=document.createElement("div");
  card.className="card";
  card.innerHTML=`
    <div class="ak47">
      <div class="barrel"></div>
      <div class="stock"></div>
      <div class="mag"></div>
      <div class="sight"></div>
    </div>
    <h3>${p.name}</h3>
    <span class="status">Disponible</span><span class="tag">PUBG</span>
    <div class="price">${p.price} HTG</div>
    <button class="btn-primary">Acheter</button>
  `;
  card.querySelector("button").addEventListener("click",()=>{
    selectedProduct=p;
    document.getElementById("popupTitle").textContent=p.name+" - "+p.price+" HTG";
    document.getElementById("popup").style.display="flex";
  });
  grid.appendChild(card);
});

/* ==========================
   POPUP
========================== */
function closePopup(){document.getElementById("popup").style.display="none";}
function addToCart(){
  const type=document.getElementById("accountType").value;
  const emailF=document.getElementById("emailForm").value;
  const mdp=document.getElementById("passwordForm").value;
  const uid=document.getElementById("uidForm").value;
  const wp=document.getElementById("whatsappForm").value;
  const country=document.getElementById("countryForm").value;
  if(!type||!emailF||!mdp||!uid||!wp){alert("⚠ Merci de remplir tout le formulaire !");return;}

  const cart=loadCart();
  cart.push({name:selectedProduct.name,price:selectedProduct.price,buyer:user.email,date:new Date().toLocaleString(),status:"En attente",meta:{accountName:user.username,type,type,email:emailF,password:mdp,uid,whatsapp:country+" "+wp}});
  saveCart(cart);
  showToast();
  closePopup();
}

/* INIT */
updateBalanceUI();
setInterval(updateBalanceUI,1500);
</script>
</body>
</html>
