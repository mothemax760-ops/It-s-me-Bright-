<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bright Tup Up | Google Play & Efootball</title>
<style>
body { font-family: 'Poppins', sans-serif; background: radial-gradient(circle at top left, #000 40%, #001a33 100%); margin:0; padding:0; color:#e0f7ff; }
header { display:flex; justify-content:space-between; align-items:center; padding:15px 20px; background:rgba(5,10,20,0.95); position:sticky; top:0; z-index:20; border-bottom:2px solid #00aaff; box-shadow:0 0 10px #00aaff; }
.back-btn { background:none; border:2px solid #00aaff; padding:6px 12px; border-radius:8px; cursor:pointer; font-weight:bold; color:#00ccff; }
.right-box { display:flex; align-items:center; gap:14px; }
.balance { padding:6px 12px; background:rgba(0,0,0,0.4); color:#00ccff; border-radius:8px; font-weight:bold; border:1px solid #00aaff; box-shadow:0 0 10px #00aaff; }
.cart-btn { cursor:pointer; font-size:1.4rem; }
.product-card { background:rgba(5,10,20,0.95); margin:15px; padding:15px; border-radius:14px; border:1px solid #00aaff33; display:flex; align-items:center; gap:15px; box-shadow:0 0 12px #00aaff22; }
.product-img { width:70px; border-radius:50%; border:2px solid #00aaff; box-shadow:0 0 10px #00aaff66; }
.btn-add { margin-left:auto; background:linear-gradient(90deg,#00aaff,#004466); color:#000; padding:10px 15px; border-radius:8px; border:none; cursor:pointer; font-weight:bold; box-shadow:0 0 10px #00aaff; }
.btn-add:hover { box-shadow:0 0 15px #00aaff; }
.tag { display:inline-block; background:#00c853; color:white; padding:4px 10px; border-radius:10px; font-size:0.8rem; margin-top:6px; }
.tag2 { background:#9e9e9e; }
.modal-bg { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.75); display:none; justify-content:center; align-items:center; z-index:9999; }
.modal-box { background:rgba(5,10,20,0.95); border:2px solid #00aaff; width:90%; max-width:420px; padding:25px; border-radius:12px; color:white; box-shadow:0 0 25px #00aaff; animation:zoom 0.3s ease; }
@keyframes zoom { from{transform:scale(0.7); opacity:0;} to{transform:scale(1); opacity:1;} }
.modal-box h2 { text-align:center; font-size:24px; color:#00ccff; margin-bottom:15px; }
.modal-box input, .modal-box select { width:100%; padding:12px; margin-top:10px; border-radius:8px; border:1px solid #00aaff; background:rgba(0,0,0,0.4); color:#e0f7ff; }
.modal-box button { width:100%; padding:12px; margin-top:18px; background:linear-gradient(90deg,#00aaff,#004466); border:none; color:#000; font-weight:bold; border-radius:8px; font-size:17px; cursor:pointer; }
.close-btn { background:red !important; color:white !important; }
.toast { position:fixed; bottom:25px; left:50%; transform:translateX(-50%); background:#00aaff; color:#000; padding:10px 20px; border-radius:10px; font-weight:bold; opacity:0; transition:opacity 0.4s; }
.toast.show { opacity:1; }
h2.page-title { margin-left:15px; color:#00ccff; text-shadow:0 0 12px #00aaff; font-weight:800; }
</style>
</head>
<body>

<header>
  <button class="back-btn" onclick="window.location.href='produits.html'">â† Retour</button>
  <div class="right-box">
    <div class="balance" id="balanceBox">0 G</div>
    <div class="cart-btn" onclick="openCart()">ğŸ›’(<span id="cartCount">0</span>)</div>
  </div>
</header>

<h2 class="page-title">GOOGLE PLAY & EFOOTBALL â€” Bright Tup Up</h2>
<div id="product-list"></div>

<div class="modal-bg" id="orderModal">
  <div class="modal-box">
    <h2>Informations obligatoires</h2>
    <input type="text" id="typeTel" placeholder="Type de tÃ©lÃ©phone (PS5, PS4, Mobile)">
    <input type="email" id="email" placeholder="Votre Email">
    <input type="password" id="password" placeholder="Mot de passe">
    <select id="country">
      <option value="+509">ğŸ‡­ğŸ‡¹ HaÃ¯ti (+509)</option>
      <option value="+1">ğŸ‡ºğŸ‡¸ USA (+1)</option>
      <option value="+33">ğŸ‡«ğŸ‡· France (+33)</option>
      <option value="+229">ğŸ‡§ğŸ‡¯ BÃ©nin (+229)</option>
      <option value="+221">ğŸ‡¸ğŸ‡³ SÃ©nÃ©gal (+221)</option>
      <option value="+225">ğŸ‡¨ğŸ‡® CÃ´te d'Ivoire (+225)</option>
    </select>
    <input type="text" id="whatsapp" placeholder="NumÃ©ro Whatsapp">
    <button onclick="validateForm()">Valider la commande</button>
    <button class="close-btn" onclick="closeModal()">Annuler</button>
  </div>
</div>

<div id="toast" class="toast">âœ… AjoutÃ© au panier</div>

<script>
// ====================== PROFIL SÃ‰CURISÃ‰ ======================
let user = JSON.parse(sessionStorage.getItem("dpstore_user") || "null");
if(!user || !user.email || !user.username){
  alert("âš  Vous devez Ãªtre connectÃ© !");
  window.location.href="index.html";
}
if(!user.balance) user.balance = 0;

// ====================== PANIER PAR COMPTE ======================
function normalizeId(str){ return (str||"guest").toLowerCase().replace(/[^a-z0-9@.-]/g,"_").replace(/@/g,"_at_"); }
function getCartKey(){ return "cart_" + normalizeId(user.email); }
function loadCart(){ return JSON.parse(localStorage.getItem(getCartKey())||"[]"); }
function saveCart(arr){ localStorage.setItem(getCartKey(), JSON.stringify(arr)); }

// ====================== SOLDE & COMPTEURS ======================
function updateBalanceUI(){
  user = JSON.parse(sessionStorage.getItem("dpstore_user") || JSON.stringify(user));
  document.getElementById("balanceBox").textContent = (user.balance ?? 0)+" G";
  document.getElementById("cartCount").textContent = loadCart().length;
}
updateBalanceUI();
setInterval(updateBalanceUI,1500);

// ====================== PRODUITS ======================
const footballImg="https://upload.wikimedia.org/wikipedia/commons/d/d3/Football_icon.svg";
const products=[
  {name:"550 PIÃˆCES",price:770,img:footballImg},{name:"750 PIÃˆCES",price:1045,img:footballImg},
  {name:"1040 PIÃˆCES",price:1420,img:footballImg},{name:"2130 PIÃˆCES",price:2880,img:footballImg},
  {name:"3250 PIÃˆCES",price:4320,img:footballImg},{name:"5700 PIÃˆCES",price:7050,img:footballImg},
  {name:"12800 PIÃˆCES",price:15070,img:footballImg}
];
products.forEach(p=>p.price=Math.round(p.price*1.20));

const container=document.getElementById("product-list");
let selectedProduct=null;
products.forEach(p=>{
  container.innerHTML+=`
  <div class="product-card">
    <img src="${p.img}" class="product-img">
    <div>
      <div style="font-weight:bold;font-size:1.1rem;">${p.name}</div>
      <span class="tag">Disponible</span>
      <span class="tag tag2">Efootball</span>
      <div style="font-size:1.1rem;margin-top:6px;">${p.price} HTG</div>
    </div>
    <button class="btn-add" onclick="openForm('${p.name}',${p.price})">Ajouter</button>
  </div>`;
});

// ====================== MODAL ======================
function openForm(name,price){
  selectedProduct={name,price};
  document.getElementById("orderModal").style.display="flex";
  document.getElementById("email").value = user.email || "";
}
function closeModal(){ document.getElementById("orderModal").style.display="none"; }
document.getElementById("country").addEventListener("change",function(){ document.getElementById("whatsapp").value=this.value+" "; });

// ====================== AJOUT AU PANIER ======================
function validateForm(){
  const typeTel=document.getElementById("typeTel").value.trim();
  const email=document.getElementById("email").value.trim();
  const pwd=document.getElementById("password").value.trim();
  const whatsapp=document.getElementById("whatsapp").value.trim();
  if(!typeTel||!email||!pwd||!whatsapp){ alert("Veuillez remplir tous les champs."); return; }

  let cart=loadCart();
  cart.push({
    ...selectedProduct,
    buyer: user.email,
    date: new Date().toLocaleString(),
    status: "En attente",
    meta: { accountName: user.username, typeTel, email, pwd, whatsapp }
  });
  saveCart(cart);
  updateBalanceUI();
  closeModal();
  showToast();
}

function openCart(){
  localStorage.setItem("lastPage", window.location.href);
  window.location.href="cart.html";
}

function showToast(){
  const toast = document.getElementById("toast");
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),1500);
}
</script>

</body>
</html>
